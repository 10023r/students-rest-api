<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <title>Document</title>
</head>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<body>
<h1 class="h-100 d-flex align-items-center justify-content-center">Students REST API</h1>
<div class="d-flex justify-content-around ">
    <div id="students" class="">
        <table class="table">
            <thead>
            <tr>
                <th></th>
                <th>ID</th>
                <th>Имя</th>
                <th>Фамилия</th>
                <th>Отчество</th>
                <th>Дата рождения</th>
                <th>Группа</th>
            </tr>
            </thead>
            <tbody id="students_table_content">
            </tbody>
        </table>
    </div>

    <div class="d-flex flex-column">
        <h3 class="text-center">Информация о студенте</h3>
        <div class="d-flex flex-column align-items-center gap-2 ">
            <label>
                Имя:<br>
                <input type="text" id="first_name" required>
            </label>
            <label>
                Фамилия:<br>
                <input type="text" id="last_name">
            </label>
            <label>
                Отчество:<br>
                <input type="text" id="fathers_name">
            </label>
            <label class="">
                Дата рождения:<br>
                <input type="date" id="birth_date">
            </label>
            <label>
                Группа:<br>
                <input type="text" id="group_name">
            </label>
            <input type="submit" id="createStudent" value="Создать" class=""/>
        </div>
    </div>
</div>
<script>
    let students = []
    $.get("http://localhost:8080/api/students", function (data) {
        students = data
        updateContent(students)
    });


    function handleDelete(id) {
        $.ajax({
            url: `http://localhost:8080/api/students/${id}`,
            type: 'DELETE',
            success: function (resp) {
                for (let i in students) {
                    if (students[i].id === id) {
                        students.splice(i, 1)
                        updateContent(students)
                    }
                }
            }
        });
    }

    function validateInput() {
        let fields = ["#first_name", "#last_name", "#fathers_name", "#birth_date", "#group_name"]
        for (let i in fields) {
            if ($(fields[i]).val() === "") {
                return false
            }
        }
        return true;
    }


    function formattedString(obj) {
        str = `<tr>
                    <td><button onclick="handleDelete(${obj.id})" class="btn btn-danger">Удалить</button></td>
                    <td>${obj.id}</td>
                    <td>${obj.first_name}</td>
                    <td>${obj.last_name}</td>
                    <td>${obj.fathers_name}</td>
                    <td>${obj.birth_date}</td>
                    <td>${obj.group_name}</td>
               </tr>`
        return str
    }

    function prepareContent(data) {
        prepared = []
        for (let i = 0; i < data.length; i++) {
            prepared.push(formattedString(data[i]))
        }
        return prepared
    }

    function updateContent(content) {
        let formatted = prepareContent(content)
        $('#students_table_content').html(formatted)
    }

    $('#createStudent').click(e => {
        if (!validateInput()) {
            alert("Заполните все поля.")
            return
        }
        let stud = {
            first_name: $("#first_name").val(),
            last_name: $("#last_name").val(),
            fathers_name: $("#fathers_name").val(),
            birth_date: $("#birth_date").val(),
            group_name: $("#group_name").val()
        }
        $.post("http://localhost:8080/api/students", stud, function (data) {
            console.log(data)
            stud.id = data;
            students.push(stud)
            updateContent(students)
        });
    })

</script>
</body>
</html>